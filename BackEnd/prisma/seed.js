// prisma/seed.js
import { PrismaClient } from '@prisma/client';
import bcrypt from 'bcrypt';

const prisma = new PrismaClient();

async function main() {
  console.log('üå± Iniciando seed de la base de datos...');

  // Limpiar datos existentes (opcional - comentar si no quieres borrar)
  await prisma.comentario.deleteMany();
  await prisma.like.deleteMany();
  await prisma.post.deleteMany();
  await prisma.postulacion.deleteMany();
  await prisma.oferta.deleteMany();
  await prisma.usuario.deleteMany();
  await prisma.empresa.deleteMany();

  console.log('‚úÖ Base de datos limpiada');

  // Hash de contrase√±a para todos los usuarios de prueba
  const passwordHash = await bcrypt.hash('password123', 10);

  // ==================== USUARIOS ====================
  console.log('üë§ Creando usuarios...');

  const usuario1 = await prisma.usuario.create({
    data: {
      nombre: 'Mar√≠a Gonz√°lez',
      email: 'maria@example.com',
      password: passwordHash,
      fechaNacimiento: new Date('2002-05-15'), // 23 a√±os - JOVEN
      tipo: 'JOVEN',
      rol: 'USUARIO',
      avatar: '/img/usuario.png',
      bio: 'Estudiante de Marketing Digital apasionada por las redes sociales y el branding. Buscando mi primera oportunidad laboral üöÄ',
      ubicacion: 'Montevideo, Uruguay',
      puntos: 120
    }
  });

  const usuario2 = await prisma.usuario.create({
    data: {
      nombre: 'Carlos Rodr√≠guez',
      email: 'carlos@example.com',
      password: passwordHash,
      fechaNacimiento: new Date('2003-08-22'), // 22 a√±os - JOVEN
      tipo: 'JOVEN',
      rol: 'USUARIO',
      avatar: '/img/usuario.png',
      bio: 'Desarrollador frontend junior. Conocimientos en React, JavaScript y dise√±o web. ¬°Listo para aprender!',
      ubicacion: 'Buenos Aires, Argentina',
      puntos: 85
    }
  });

  const usuario3 = await prisma.usuario.create({
    data: {
      nombre: 'Ana Mart√≠nez',
      email: 'ana@example.com',
      password: passwordHash,
      fechaNacimiento: new Date('2008-03-10'), // 17 a√±os - ADOLESCENTE
      tipo: 'ADOLESCENTE',
      rol: 'USUARIO',
      avatar: '/img/usuario.png',
      bio: 'Estudiante de secundaria interesada en dise√±o gr√°fico y redes sociales üé®',
      ubicacion: 'Santiago, Chile',
      puntos: 45
    }
  });

  const adminUser = await prisma.usuario.create({
    data: {
      nombre: 'Admin Sistema',
      email: 'admin@nexo.com',
      password: passwordHash,
      fechaNacimiento: new Date('1995-01-01'), // 30 a√±os - JOVEN (pero admin)
      tipo: 'JOVEN',
      rol: 'ADMIN',
      avatar: '/img/usuario.png',
      bio: 'Administrador del sistema Nexo',
      ubicacion: 'Montevideo, Uruguay',
      puntos: 500
    }
  });

  console.log(`‚úÖ ${4} usuarios creados`);

  // ==================== EMPRESAS ====================
  console.log('üè¢ Creando empresas...');

  const empresa1 = await prisma.empresa.create({
    data: {
      nombre: 'Globant',
      email: 'rrhh@globant.com',
      password: passwordHash,
      descripcion: 'Somos una compa√±√≠a nativa digital que ayuda a organizaciones a reinventarse y desbloquear su potencial.',
      logo: '/img/globant.jpg',
      sector: 'Tecnolog√≠a',
      ubicacion: 'Montevideo, Uruguay'
    }
  });

  const empresa2 = await prisma.empresa.create({
    data: {
      nombre: 'MercadoLibre',
      email: 'careers@mercadolibre.com',
      password: passwordHash,
      descripcion: 'L√≠der en e-commerce y fintech en Am√©rica Latina. Democratizamos el comercio y los servicios financieros.',
      logo: '/img/MerL.png',
      sector: 'E-commerce / Fintech',
      ubicacion: 'Buenos Aires, Argentina'
    }
  });

  const empresa3 = await prisma.empresa.create({
    data: {
      nombre: 'Conaprole',
      email: 'trabajo@conaprole.com.uy',
      password: passwordHash,
      descripcion: 'Cooperativa Nacional de Productores de Leche. Principal empresa l√°ctea de Uruguay.',
      logo: '/img/Conaprole.png',
      sector: 'Industria Alimentaria',
      ubicacion: 'Montevideo, Uruguay'
    }
  });

  console.log(`‚úÖ ${3} empresas creadas`);

  // ==================== OFERTAS LABORALES ====================
  console.log('üíº Creando ofertas laborales...');

  const oferta1 = await prisma.oferta.create({
    data: {
      empresaId: empresa1.id,
      titulo: 'Desarrollador Frontend Junior',
      descripcion: 'Buscamos un desarrollador frontend junior con ganas de aprender y crecer en un ambiente din√°mico. Trabajar√°s con tecnolog√≠as modernas y equipos √°giles.\n\n**Responsabilidades:**\n‚Ä¢ Desarrollar interfaces de usuario atractivas y funcionales\n‚Ä¢ Colaborar con dise√±adores UX/UI para implementar mockups\n‚Ä¢ Escribir c√≥digo limpio, mantenible y bien documentado\n‚Ä¢ Participar en revisiones de c√≥digo y reuniones de equipo\n‚Ä¢ Aprender nuevas tecnolog√≠as y metodolog√≠as de desarrollo\n‚Ä¢ Optimizar el rendimiento de aplicaciones web\n‚Ä¢ Implementar pruebas unitarias y de integraci√≥n\n‚Ä¢ Mantener documentaci√≥n t√©cnica actualizada\n‚Ä¢ Trabajar en equipo usando metodolog√≠as √°giles\n‚Ä¢ Resolver bugs y problemas t√©cnicos\n\n**Requisitos T√©cnicos:**\n‚Ä¢ Experiencia m√≠nima de 1 a√±o en desarrollo frontend\n‚Ä¢ Dominio de HTML5, CSS3 y JavaScript ES6+\n‚Ä¢ Conocimiento s√≥lido de React y sus ecosistemas\n‚Ä¢ Familiaridad con herramientas de build (Webpack, Vite)\n‚Ä¢ Experiencia con sistemas de control de versiones (Git)\n‚Ä¢ Conocimientos de responsive design y mobile-first\n‚Ä¢ Comprensi√≥n de principios de accesibilidad web\n‚Ä¢ Experiencia con APIs RESTful\n\n**Beneficios:**\n‚Ä¢ Horarios flexibles y trabajo remoto opcional\n‚Ä¢ Capacitaciones y cursos pagos por la empresa\n‚Ä¢ Ambiente de trabajo joven y din√°mico\n‚Ä¢ Posibilidades de crecimiento profesional\n‚Ä¢ Snacks y almuerzo en la oficina\n‚Ä¢ Seguro m√©dico privado\n‚Ä¢ D√≠as de vacaciones adicionales\n‚Ä¢ Budget para equipamiento y home office\n‚Ä¢ Eventos y actividades de team building\n‚Ä¢ Acceso a conferencias y meetups tecnol√≥gicos\n\n**Proceso de Selecci√≥n:**\n‚Ä¢ Entrevista inicial con RRHH (30 minutos)\n‚Ä¢ Prueba t√©cnica para resolver en casa (2-3 horas)\n‚Ä¢ Entrevista t√©cnica con el equipo de desarrollo (1 hora)\n‚Ä¢ Entrevista final con el CTO (30 minutos)\n‚Ä¢ Propuesta y onboarding',
      ubicacion: 'Montevideo, Uruguay',
      salario: '$40,000 - $60,000 UYU',
      tipo: 'Tiempo completo',
      area: 'tecnologia',
      modalidad: 'H√≠brido',
      requisitos: '‚Ä¢ Conocimientos b√°sicos de HTML, CSS, JavaScript\n‚Ä¢ React (deseable)\n‚Ä¢ Git y control de versiones\n‚Ä¢ Ingl√©s intermedio\n‚Ä¢ Pasi√≥n por aprender',
      activa: true,
      fechaVencimiento: new Date('2025-12-31')
    }
  });

  const oferta2 = await prisma.oferta.create({
    data: {
      empresaId: empresa2.id,
      titulo: 'Analista de Marketing Digital Junior',
      descripcion: '√önete a nuestro equipo de marketing digital para ayudarnos a crear campa√±as innovadoras en redes sociales y e-commerce.\n\n**Responsabilidades:**\n‚Ä¢ Crear y gestionar contenido para redes sociales (Instagram, Facebook, TikTok, LinkedIn)\n‚Ä¢ Dise√±ar estrategias de marketing digital alineadas con objetivos comerciales\n‚Ä¢ Analizar m√©tricas y KPIs de campa√±as digitales\n‚Ä¢ Colaborar con el equipo de dise√±o para crear piezas gr√°ficas\n‚Ä¢ Gestionar presupuestos de publicidad digital\n‚Ä¢ Realizar investigaci√≥n de mercado y an√°lisis de competencia\n‚Ä¢ Optimizar campa√±as de email marketing\n‚Ä¢ Coordinar con influencers y partners digitales\n‚Ä¢ Crear reportes mensuales de performance\n‚Ä¢ Mantenerse actualizado con tendencias de marketing digital\n\n**Requisitos:**\n‚Ä¢ Estudiante o reci√©n graduado en Marketing, Comunicaci√≥n o afines\n‚Ä¢ Conocimiento profundo de redes sociales y sus algoritmos\n‚Ä¢ Google Analytics y herramientas de an√°lisis web\n‚Ä¢ Experiencia con Meta Business Suite y Google Ads (deseable)\n‚Ä¢ Habilidades de copywriting y storytelling\n‚Ä¢ Conocimientos b√°sicos de dise√±o (Canva, Adobe Creative Suite)\n‚Ä¢ Capacidad anal√≠tica y orientaci√≥n a resultados\n‚Ä¢ Creatividad y pensamiento innovador\n‚Ä¢ Excelente comunicaci√≥n escrita y verbal\n\n**Beneficios:**\n‚Ä¢ Trabajo 100% remoto\n‚Ä¢ Horarios flexibles\n‚Ä¢ Presupuesto para cursos y certificaciones\n‚Ä¢ Acceso a herramientas premium de marketing\n‚Ä¢ D√≠as libres por cumplea√±os\n‚Ä¢ Ambiente colaborativo y creativo\n‚Ä¢ Oportunidades de crecimiento r√°pido\n‚Ä¢ Bonos por performance',
      ubicacion: 'Buenos Aires, Argentina',
      salario: '$80,000 - $120,000 ARS',
      tipo: 'Medio tiempo',
      area: 'marketing',
      modalidad: 'Remoto',
      requisitos: '‚Ä¢ Estudiante o reci√©n graduado en Marketing, Comunicaci√≥n o afines\n‚Ä¢ Conocimiento de redes sociales\n‚Ä¢ Google Analytics (deseable)\n‚Ä¢ Creatividad y proactividad',
      activa: true,
      fechaVencimiento: new Date('2025-11-30')
    }
  });

  const oferta3 = await prisma.oferta.create({
    data: {
      empresaId: empresa1.id,
      titulo: 'QA Tester - Programa Trainee',
      descripcion: 'Programa trainee de 3 meses para formar QA testers. No se requiere experiencia previa, solo muchas ganas de aprender.',
      ubicacion: 'Montevideo, Uruguay',
      salario: '$35,000 - $45,000 UYU',
      tipo: 'Trainee',
      area: 'tecnologia',
      modalidad: 'Presencial',
      requisitos: '‚Ä¢ Sin experiencia previa requerida\n‚Ä¢ Atenci√≥n al detalle\n‚Ä¢ Capacidad anal√≠tica\n‚Ä¢ Trabajo en equipo\n‚Ä¢ Disponibilidad completa',
      activa: true,
      fechaVencimiento: new Date('2025-10-31')
    }
  });

  const oferta4 = await prisma.oferta.create({
    data: {
      empresaId: empresa3.id,
      titulo: 'Asistente Administrativo',
      descripcion: 'Buscamos asistente administrativo para apoyar en tareas de gesti√≥n documental, atenci√≥n telef√≥nica y apoyo general.',
      ubicacion: 'Montevideo, Uruguay',
      salario: '$30,000 - $40,000 UYU',
      tipo: 'Tiempo completo',
      area: 'administracion',
      modalidad: 'Presencial',
      requisitos: '‚Ä¢ Bachillerato completo\n‚Ä¢ Manejo de Office (Word, Excel)\n‚Ä¢ Buena comunicaci√≥n\n‚Ä¢ Organizaci√≥n y responsabilidad',
      activa: true,
      fechaVencimiento: new Date('2025-11-15')
    }
  });

  const oferta5 = await prisma.oferta.create({
    data: {
      empresaId: empresa2.id,
      titulo: 'Desarrollador Backend Node.js',
      descripcion: 'Desarrollador backend para trabajar en microservicios y APIs REST. Experiencia m√≠nima de 1 a√±o.',
      ubicacion: 'Buenos Aires, Argentina',
      salario: '$150,000 - $200,000 ARS',
      tipo: 'Tiempo completo',
      area: 'tecnologia',
      modalidad: 'Remoto',
      requisitos: '‚Ä¢ Node.js y Express\n‚Ä¢ Bases de datos (SQL/NoSQL)\n‚Ä¢ APIs REST\n‚Ä¢ Git\n‚Ä¢ Ingl√©s intermedio-avanzado',
      activa: true,
      fechaVencimiento: new Date('2026-01-31')
    }
  });

  console.log(`‚úÖ ${5} ofertas creadas`);

  // ==================== POSTULACIONES ====================
  console.log('üìù Creando postulaciones...');

  await prisma.postulacion.create({
    data: {
      usuarioId: usuario1.id,
      ofertaId: oferta2.id,
      estado: 'PENDIENTE'
    }
  });

  await prisma.postulacion.create({
    data: {
      usuarioId: usuario2.id,
      ofertaId: oferta1.id,
      estado: 'ACEPTADA'
    }
  });

  await prisma.postulacion.create({
    data: {
      usuarioId: usuario2.id,
      ofertaId: oferta3.id,
      estado: 'PENDIENTE'
    }
  });

  console.log(`‚úÖ ${3} postulaciones creadas`);

  // ==================== POSTS ====================
  console.log('üì∞ Creando posts...');

  const post1 = await prisma.post.create({
    data: {
      usuarioId: usuario1.id,
      contenido: '¬°Acabo de completar mi primer curso de Marketing Digital! üöÄ Muy emocionada de aplicar todo lo aprendido. ¬øAlguien m√°s est√° estudiando marketing?',
      imagenUrl: '/img/img1.png'
    }
  });

  const post2 = await prisma.post.create({
    data: {
      empresaId: empresa1.id,
      contenido: 'üåü ¬°Nueva oportunidad para j√≥venes desarrolladores! Estamos buscando talentos entre 18-25 a√±os para nuestro programa de trainee. ¬°Aplica ahora!',
      imagenUrl: null
    }
  });

  const post3 = await prisma.post.create({
    data: {
      usuarioId: usuario2.id,
      contenido: 'Hoy aprend√≠ sobre React Hooks y estoy fascinado con lo poderosos que son. ¬øAlguien tiene tips para alguien que reci√©n empieza? üíª',
      imagenUrl: null
    }
  });

  const post4 = await prisma.post.create({
    data: {
      empresaId: empresa2.id,
      contenido: 'üì¶ En MercadoLibre estamos buscando j√≥venes talentos para nuestro equipo de marketing digital. Si te apasionan las redes sociales y el e-commerce, ¬°esta es tu oportunidad!',
      imagenUrl: '/img/MercLP.jpg'
    }
  });

  const post5 = await prisma.post.create({
    data: {
      usuarioId: usuario1.id,
      contenido: '¬°Acabo de postularme a mi primera oferta laboral! Nervios y emoci√≥n al mismo tiempo üòä ¬øAlg√∫n consejo para una entrevista exitosa?',
      imagenUrl: null
    }
  });

  const post6 = await prisma.post.create({
    data: {
      usuarioId: usuario3.id,
      contenido: 'Dise√±√© mi primer logo para un proyecto de clase. ¬°Qu√© emocionante es crear algo desde cero! üé® #DesignLife',
      imagenUrl: null
    }
  });

  const post7 = await prisma.post.create({
    data: {
      empresaId: empresa3.id,
      contenido: 'En Conaprole valoramos el talento joven uruguayo. Si eres proactivo y quieres crecer en una empresa l√≠der, revisa nuestras oportunidades.',
      imagenUrl: '/img/ConaproleSh.png'
    }
  });

  const post8 = await prisma.post.create({
    data: {
      usuarioId: usuario2.id,
      contenido: '¬°Gran noticia! Me aceptaron en el programa trainee de Globant üéâ Gracias a todos los que me apoyaron en este proceso.',
      imagenUrl: null
    }
  });

  console.log(`‚úÖ ${8} posts creados`);

  // ==================== LIKES ====================
  console.log('‚ù§Ô∏è Creando likes...');

  await prisma.like.create({
    data: { postId: post1.id, usuarioId: usuario2.id }
  });

  await prisma.like.create({
    data: { postId: post1.id, usuarioId: usuario3.id }
  });

  await prisma.like.create({
    data: { postId: post2.id, usuarioId: usuario1.id }
  });

  await prisma.like.create({
    data: { postId: post2.id, usuarioId: usuario2.id }
  });

  await prisma.like.create({
    data: { postId: post3.id, usuarioId: usuario1.id }
  });

  await prisma.like.create({
    data: { postId: post5.id, usuarioId: usuario2.id }
  });

  await prisma.like.create({
    data: { postId: post8.id, usuarioId: usuario1.id }
  });

  await prisma.like.create({
    data: { postId: post8.id, usuarioId: usuario3.id }
  });

  console.log(`‚úÖ ${8} likes creados`);

  // ==================== COMENTARIOS ====================
  console.log('üí¨ Creando comentarios...');

  const comentario1 = await prisma.comentario.create({
    data: {
      postId: post1.id,
      usuarioId: usuario2.id,
      contenido: '¬°Felicitaciones Mar√≠a! Yo tambi√©n estoy estudiando marketing. ¬øQu√© curso hiciste?',
      parentId: null
    }
  });

  await prisma.comentario.create({
    data: {
      postId: post1.id,
      usuarioId: usuario1.id,
      contenido: 'Gracias Carlos! Hice el de Google Digital Garage, s√∫per recomendado üòä',
      parentId: comentario1.id // Respuesta al comentario anterior
    }
  });

  await prisma.comentario.create({
    data: {
      postId: post3.id,
      usuarioId: usuario1.id,
      contenido: 'Los hooks son geniales! Te recomiendo empezar con useState y useEffect, son los m√°s usados.',
      parentId: null
    }
  });

  await prisma.comentario.create({
    data: {
      postId: post5.id,
      usuarioId: usuario2.id,
      contenido: '¬°Mucha suerte! Mi consejo: s√© t√∫ mismo/a, investiga sobre la empresa y prepara preguntas para hacerles.',
      parentId: null
    }
  });

  await prisma.comentario.create({
    data: {
      postId: post8.id,
      usuarioId: usuario1.id,
      contenido: '¬°¬°¬°Felicitaciones Carlos!!! Te lo mereces, trabajaste duro para esto üéâ',
      parentId: null
    }
  });

  console.log(`‚úÖ ${5} comentarios creados`);

  // ==================== RESUMEN ====================
  console.log('\nüìä RESUMEN DEL SEED:');
  console.log(`   üë§ Usuarios: 4 (3 regulares + 1 admin)`);
  console.log(`   üè¢ Empresas: 3`);
  console.log(`   üíº Ofertas: 5`);
  console.log(`   üìù Postulaciones: 3`);
  console.log(`   üì∞ Posts: 8`);
  console.log(`   ‚ù§Ô∏è Likes: 8`);
  console.log(`   üí¨ Comentarios: 5`);
  console.log('\n‚úÖ Seed completado exitosamente!');
  console.log('\nüìù CREDENCIALES DE PRUEBA:');
  console.log('   Usuario: maria@example.com / password123');
  console.log('   Usuario: carlos@example.com / password123');
  console.log('   Adolescente: ana@example.com / password123');
  console.log('   Admin: admin@nexo.com / password123');
  console.log('   Empresa: rrhh@globant.com / password123');
  console.log('   Empresa: careers@mercadolibre.com / password123');
}

main()
  .catch((e) => {
    console.error('‚ùå Error durante el seed:', e);
    process.exit(1);
  })
  .finally(async () => {
    await prisma.$disconnect();
  });
